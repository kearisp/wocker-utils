name: Test

inputs:
    CODECOV_TOKEN:
        required: true
        description: 'CODECOV_TOKEN'

runs:
    using: 'composite'
    steps:
      - name: Test
        shell: bash
        run: |
            npm run test -- --coverage --coverageReporters lcovonly json-summary
            mkdir -p /tmp/coverage
            mv ./coverage/* /tmp/coverage/
#            npm run make-coverage-badge

#      - name: Upload to Gist
#        uses: exuanbo/actions-deploy-gist@v1
#        with:
#            token: ${{ secrets.GIST_TOKEN }}
#            gist_id: ${{ vars.GIST_ID }}
#            file_path: "./coverage/badge.svg"
#            file_type: "binary"
#            gist_file_name: "coverage.svg"

      - name: Upload coverage reports to Codecov
        if: github.repository_owner == 'kearisp'
        uses: codecov/codecov-action@v5
        working-directory: /tmp/coverage
        with:
            token: ${{ inputs.CODECOV_TOKEN }}
            directory: /tmp/coverage
